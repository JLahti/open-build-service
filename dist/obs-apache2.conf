
Listen 81
Listen 82

# Passenger defaults
PassengerSpawnMethod "smart"
PassengerMaxPoolSize 20
#RailsEnv "development"

# allow long request urls and being part of headers
LimitRequestLine 20000
LimitRequestFieldsize 20000

# Just the overview page

# Build Results
<VirtualHost *:82>
        # The resulting repositories
        DocumentRoot  "/srv/obs/repos"

        <Directory /srv/obs/repos>
           Options Indexes FollowSymLinks
           Allow from all
        </Directory>
</VirtualHost>


# OBS API
<VirtualHost *:81>
        ServerName api

	#  General setup for the virtual host
        DocumentRoot  "/srv/www/obs/api/public"
	ErrorLog /srv/www/obs/api/log/apache_error_log
	TransferLog /srv/www/obs/api/log/apache_access_log

        PassengerMinInstances 2
        PassengerPreStart http://api:81

        <Directory /srv/www/obs/api/public>
           AllowOverride all
           Options -MultiViews

           # This requires mod_xforward loaded in apache 
           # Enable the usage via options.yml
           # This will decrease the load due to long running requests a lot (unloading from rails stack)
           # XForward on

           Allow from all
        </Directory>

	SetEnvIf User-Agent ".*MSIE [1-5].*" \
		 nokeepalive ssl-unclean-shutdown \
		 downgrade-1.0 force-response-1.0

</VirtualHost>


# OBS WEB interface
<VirtualHost *:80>
        ServerName webui

	#  General setup for the virtual host
        DocumentRoot  "/srv/www/obs/webui/public"
	ErrorLog /srv/www/obs/webui/log/apache_error_log
	TransferLog /srv/www/obs/webui/log/apache_access_log

        PassengerPreStart https://build

        <Directory /srv/www/obs/webui/public>
           AllowOverride all
           Options -MultiViews

           # This requires mod_xforward loaded in apache 
           # Enable the usage via options.yml
           # This will decrease the load due to long running requests a lot (unloading from rails stack)
           # XForward on

           Allow from all
        </Directory>                                                                                                                                                                                         

	SetEnvIf User-Agent ".*MSIE [1-5].*" \
		 nokeepalive ssl-unclean-shutdown \
		 downgrade-1.0 force-response-1.0
    ## Older firefox versions needs this, otherwise it wont cache anything over SSL.
    Header append Cache-Control "public"

</VirtualHost>                                  


